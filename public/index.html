<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fieldglass</title>
    <style>
        :root {
            /* --gray: rgb(253, 251, 252);; */ 
            --gray: rgb(34, 48, 64);
            --blue: rgb(0, 122, 253);
            --green: rgb(6, 215, 108);
            --white: rgb(253, 251, 252);
            --red: rgb(171, 37, 32);
            --purple: rgb(110, 13, 117);
            --background-dark: rgb(18,24,31);
            /* --white: rgb(34, 48, 64); */
        }

        * {
            margin:0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background-color: var(--gray);
            overflow: hidden;
        }

        .collapsible {
            background-color: var(--background-dark);
            color: white;
            cursor: pointer;
            padding: 20px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
        }

        .active, .collapsible:hover {
            background-color: #555;
        }

        .magnet-label {
            color: var(--white);
            font-family: Arial, Helvetica, sans-serif;
        }

        #magnet-output {
            display: none;
            width: 50%;
        }

        .menu-content {
            margin-bottom: 3%;
            height: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background-color: rgb(21, 31, 43);
            transition: height 1s;
        }

        .button-wrapper { 
            width: 50vw;
            height: 10vh;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            align-content: space-around;
            justify-content: space-between;
            align-items: center;
        }

        .sensor-button { 
            width: 10vw;
            height: 5vh;
        }

        .page-content {
            height: 70vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .magnet-container {
            height: 400px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            
        }

        .magnet-gauge {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            animation: neon2 1.5s ease-in-out infinite alternate;
        }
        
        .active-gauge{
            display: flex;
            animation: fadeIn .5s ease-in-out;
        }

        #magnet-buttons-container {
            width: 100%;
            height: 10%;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
        }

        .mag-button {
            height: 80%;
            width: 45%;
        }

        .progress {
            position: absolute;
            width: 100%;
            height: 100%;
            border: .1rem solid var(--white);
            border-bottom: .1rem solid var(--gray);
            border-radius: 50%;
            outline: .2rem solid var(--white);
            outline-offset: .4rem;
            overflow: hidden;
        }

        .progress::before{
            position: absolute;
            content: '';
            top:50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            background-color: var(--gray);
            border-radius: 50%;
            z-index: 200;
        }
        .progress::after{
            position: absolute;
            content: '';
            top:50%;
            width: 100%;
            height: 50%;
            background-color: var(--gray);
        }

        .bar {
            position: absolute;
            width: 50%;
            height: 100%;
            background-color: var(--green);
            transform: rotate(90deg);
            transform-origin: center right;
            animation: rotate 2s ease-in-out;
        }

        .needle {
            position: absolute;
            width: 100%;
            height: 50%;
            background-color: var(--white)!important;
            clip-path: polygon(50% 0, 50% 0, 52% 100%, 48% 100%);
            transform: rotate(90deg);
            transform-origin: bottom center;
            animation: rotate 2s ease-in-out;
            z-index: 300;

        }
        
        .magnet-readout { 
            position: absolute;
            margin-top: 50%;
            font: 1.7rem sans-serif;
            color: var(--white);
            z-index: 400;
        }

        @keyframes fadeIn {
            0% {opacity: 0;}
            100% {opacity: 1;}
        }

        @keyframes rotate {
            0% {
                background-color: var(--blue);
                transform: rotate(-90deg);
            }
            80% { background-color: var(--blue); }
        }

        @keyframes neon2 {
            from {
                box-shadow: 0 0 6px #fff, 0 0 12px #fff, 0 0 18px #fff, 0 0 24px #566f8c, 0 0 50px #566f8c, 0 0 60px #566f8c, 0 0 75px #566f8c, 0 0 90px #566f8c;
            }
            to {
                box-shadow: 0 0 2px #fff, 0 0 6px #fff, 0 0 10px #fff, 0 0 14px #566f8c, 0 0 20px #566f8c, 0 0 28px #566f8c, 0 0 40px #566f8c, 0 0 54px #566f8c;
            }
        }

        @media only screen and (max-width: 900px) {
            .button-wrapper {
                height: 15vh;
            }
            .sensor-button { 
            width: 45%;
            height: 35%;
            }
        }

    </style>
</head>
<body>
    <button class="collapsible" onclick="expandMenu()">Tools</button>
    <div class="menu-content" id="content">
        <div class="button-wrapper" id="buttons">
            <button class="sensor-button" onclick="showMag()">1</button>
            <button class="sensor-button" onclick="hideSensor()">2</button>
            <button class="sensor-button">3</button>
            <button class="sensor-button">4</button>
        </div>
    </div>

   

    <div class="page-content">
        <div class="magnet-container"  id="magnet">
            <h2 class="magnet-label">Magnetometer</h2>
            <div class="magnet-gauge">
                <div class="progress">
                    <div class="bar"></div>
                    <div class="needle"></div>
                </div>
                <span class="magnet-readout">45 μT</span>
            </div>
            <div id="magnet-buttons-container">
                <button class="mag-button" id="mag-start" onclick="magStartButton()">Start</button>
                <button class="mag-button" id="mag-stop" onclick="magStopButton()">Stop</button>
            </div>
        </div>

        <div class="slide-container" style="width: 200px; margin-top: 50px;">
            <input type="range" min="-90" max="90" value="90" class="slider" id="myRange">
        </div>

        <table id="magnet-output">
            <tr>
                <th>Timestamp</th>
                <th>X-Axis</th>
                <th>Y-Axis</th>
                <th>Z-Axis</th>
                <th>Ambient</th>
            </tr>
        </table>


    </div>
    



<script>
    //expand the menu
    function expandMenu() {
        var content = document.getElementById("content");
        var buttons = document.getElementById("buttons");
        if (content.style.height){
            content.style.height = null;
        } else {
            content.style.height = buttons.scrollHeight + "px";
        }
    }

    //collapse the menu
    function collapseMenu() {
        var content = document.getElementById("content");
        content.style.height = null;
    }

    //hide the active sensor readout
    function hideSensor() {
        var sensor = document.querySelector(".active-gauge");
        sensor.classList.remove("active-gauge");
    }




    //MAGNETOMETER    
    let magSensor = new Magnetometer({ frequency: 2 });

    function magStartButton() {
        magSensor.start();
    };

    function magStopButton() {
        magSensor.stop();
    };

    //when a new reading is taken, add a row to the "output" table. x, y, and z are dimensional axes
    magSensor.onreading = () => {
        let t = magSensor.timestamp;
        let x = magSensor.x;
        let y = magSensor.y;
        let z = magSensor.z;
        let M = Math.sqrt(Math.pow(x,2) + Math.pow(y,2) + Math.pow(z,2));

        t = t.toFixed(0);
        x = x.toFixed(4);
        y = y.toFixed(4);
        z = z.toFixed(4);
        M = M.toFixed(4);

        console.log("t, x, y, z, M", t, x, y, z, M);

        log(t,x,y,z,M)
    };

    magSensor.onerror = event => console.log(event.error.name, event.error.message);

    function log(t, x, y, z, M) {
        var table = document.getElementById('magnet-output');
        table.style.display = "block";
        // Create an empty <tr> element and add it to the 1st position of the table:
        var row = table.insertRow(-1);
        // Insert new cells (<td> elements) at the nth position of the new <tr> element:
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        // Add some text to the new cells:
        cell1.innerHTML = t;
        cell2.innerHTML = x;
        cell3.innerHTML = y;
        cell4.innerHTML = z;
        cell5.innerHTML = M;
    };

    //show the magmetometer when selected from menu
    function showMag() {
        collapseMenu();
        var gauge = document.getElementById("magnet");
        gauge.classList.add("active-gauge");
    }

    //magnetomer needle gauge motion
    const selectElement = document.querySelector(".slider");
    var readout = '';

    selectElement.addEventListener('input', (event) => {
        var readout = selectElement.value;
        document.querySelector('.magnet-readout').textContent = readout + ' μT';
        document.querySelector('.bar').style.transform = 'rotate('+readout+'deg)';
        document.querySelector('.needle').style.transform = 'rotate('+readout+'deg)';
    });

</script>



</body>
</html>